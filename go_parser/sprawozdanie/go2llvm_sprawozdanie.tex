\documentclass[a4paper,16pt]{article}
\usepackage{amssymb}
\usepackage[polish]{babel}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{graphicx}
\usepackage{times}
\usepackage[font=Large]{caption}
\usepackage{listingsutf8}
\usepackage{ucs}
\usepackage{xcolor}
\usepackage{mdframed}
\usepackage{svg}
\usepackage{setspace}
\usepackage{minted}
\usepackage[a4paper, total={7in, 8in}]{geometry}

\setlength\parindent{0pt}
\renewcommand{\baselinestretch}{1.0} 


\begin{document}
	\setstretch{2}
	{\Large Kompilatory - Go2LLVM \hfill \hfill Paweł Płatek
		
		Informatyka, 3 rok, 2018}
	

	\setstretch{1}
	\section{Gramatyka}
	
	\begin{verbatim}
		LEXER
		
		string_tok = '"' {'\"' | unicode_value | byte_value} '"'
		
		unicode_value    = unicode_char | escaped_char .
		unicode_char = /* an arbitrary Unicode code point except newline */ .
		
		escaped_char     = `\` ( "a" | "b" | "f" | "n" | "r" | "t" | "v" | `\` | "'" | `"` ) .
		
		letter           = unicode_letter | '_'
		unicode_letter = /* long list of unicode letters */;
		
		byte_value       = octal_byte_value | hex_byte_value
		octal_byte_value = '\' octal_digit octal_digit octal_digit;
		hex_byte_valye = '\x' hex_digit hex_digit
		
		bool_tok = true | false
		int_tok = (1..9) {(1..9)} | 0 {(0..7)} | 0 (x | X) {(0..9 | a..f | A..F)}
		float_tok = {(1..9)} '.' [{(1..9)}] | '.' [{(1..9)}]
		
		unary_op_tok = ('+' | '-' | '!' | '*' | '&')
		binary_op_tok = ('||' | '&&' | '==' | '!=' | '<' | '<=' | '>' | '>=' | '+' | '-' | '|' | '^'' | '*' | '/' | '%' | '<<' | '>>' | '&' | '&^')
		
		//keywords
		package_tok = 'package'
		var_tok = 'var'
		func_tok = 'func'
		return_tok = 'return'
		if_tok = 'if'
		ekse_tok = 'else'
		ident_tok =  (a..z | _) {(a..z | _) | (0..9)}
				
		// Whitespace and comments
		line_comment = '/' [{.*}]
		comment = '/*' [{.*}] '*/'
		whitespace = '\t '
		statement_termination = (';' | '\n' | comment)	
	
	\end{verbatim}
	
	\begin{verbatim}
		PARSER
		
		// top level stuff
		SourceFile = PackageClause Eos { TopLevelDecl Eos }
		PackageClause = "package" ident_tok
		
		TopLevelDecl = Declaration | FunctionDecl
		
		Block = "{" StatementList "}"
		Type = [*] IDENT_TOK
		EOS = statement_termination
		
		// Statements
		StatementList = { Statement EOS }
		Statement = Declaration | SimpleStmt | Block | ReturnStmt | IfStmt
		
		IfStmt = 'if' [SimpleStmt ';'] Expression Block ['else' (IfStmt | Block)]		
		ReturnStmt = "return" [ExpressionList]
	
		SimpleStmt = EmptyStmt | Expression | Assignment
		Assignment = identifierList [('+' | '-' | '|' | '^' | '*' | '/' | '%' | '<<' | '>>' | '&')] '=' expressionList
		EmptyStmt = ";"
		
		
		// Declarations
		Declaration = "var" IdentifierList Type ["=" ExpressionList]
        IdentifierList = ident_tok { "," ident_tok }
		
		
		// Expressions
		Expression = UnaryExpr | Expression binary_op_tok Expression
		binary_op_tok=('*' | '/' | '%' | '<<' | '>>' | '&' | '&^' | '+' | '-' | '|' | '^' | '==' | '!=' | '<' | '<=' | '>' | '>=' | '&&' | '||')
		
		UnaryExpr = unary_op_tok UnaryExpr | operand
		unary_op_tok=('*' | '&' | '+' | '-' | '!' | '^')
			
		ExpressionList = Expression { "," Expression }
		
	
		// Operands
		Operand = basicLit | ident_tok | ident_tok Arguments | "(" Expression ")"
		
		Arguments '(' [ExpressionList [',']] ')'
		
		BasicLit = int_tok | float_tok | imag_tok  | string_tok | bool_tok
		
		
		// Functions
		Function = func_tok ident_tok signature [block]
		Signature = parameters [result]
		Result = type
		
		Parameters = '(' [parameterList [',']] [...] ')'
		ParameterList = parameterDecl { COMMA parameterDecl }
		ParameterDecl = identifielList type
	\end{verbatim}

    \section{Język}
    \begin{itemize}
    	\item package
    	
    	Plik musi zaczynać się od wyrażenia 'package' identyfikator.
    	Aktualnie nie używane do niczego.
    	
    	\item functions
    	
    	Główna funkcja to 'main', musi być zdefiniowana.
    	Funkcje mogą być deklarowane (bez ciała). Taka funkcje będzie rozwiązana jako funkckja ze libc lub musi być zdefiniowana w dalczej części pliku.
    	
    	Funkcje mają argumenty (postaci '(arg1, arg type, arg3 type)').
    	Opcjonalna zwracana wartość występuje za parametrami.
    	
    	\item zmienne
    	
    	Zmienne globalne definiowane są poza funkcjami, są widoczne wszędzie.
    	Deklaracja zmiennych: 'var var\_name type'.
    	
    	\item typy
    	
    	Dozwolone typy: intX (X to ilość bitów, od 1 do (1<<24)-1), floatX (X to ilość bitów: 16, 32, 64, 128)
    	
    	Typy są dynamicznie zmieniane (poza inicjalizacją przy deklaracji, wtedy zadeklarowany typ jest zachowany).
    	
    	W razie zmiany typu, która traci precyzje, generowane jest ostrzeżenie.
    	
    	\item wskaźniki
    	
    	Postaci: 'var var\_name *type'
    	
    	Przypisanie zmiennej: 'var\_name =\&other\_var'
    	
    	Wyłuskanie: '*var\_name'
		    	    	
    	\item if/else
    	
    	Postaci: 'if expression {} else if expression {} else {}'
    	
    	\item Zasięg zmiennych
    	
    	Zmienne są ograniczone do bloków '{}'
    	
    	
    \end{itemize}


    \section{Build'n'Run}
    \begin{minted}[mathescape,
    linenos,
    numbersep=5pt,
    gobble=2,
    frame=lines,
    framesep=2mm]{c}
    
    # ANTLR -> generate parser
    $ java -jar antlr-4.7.1-complete.jar  -Werror -Dlanguage=Cpp -listener -visitor -o src/generated/ -package go_parser Go2LLVM.g4
    
    # build
    $ cmake .
    
    # run
    $ ./cmake-build-debug/go_parser
    Usage ./cmake-build-debug/go_parser file.go [-o | --out file.ll]
    
    # example
    $ /cmake-build-debug/go_parser examples/all.go && clang++ -g examples/all.ll -o ./examples/all.bin && ./examples/all.bin
    \end{minted}
    
	


\end{document}

